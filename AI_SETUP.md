# ุฅุนุฏุงุฏ ููุฒุฉ AI Analysis ูู WAF Gateway

## ๐ค ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ููุฒุฉ **AI Analysis** ุจุงุณุชุฎุฏุงู OpenAI ูุชุญููู ุฃุญุฏุงุซ WAF ุชููุงุฆูุงู ูุชูุฏูู:
- ๐ฏ ุชุญุฏูุฏ ููุน ุงููุฌูู
- โ๏ธ ุชูููู ูุณุชูู ุงูุฎุทูุฑุฉ
- ๐ ุดุฑุญ ุชูุตููู ููุญุฏุซ
- ๐ก ุชูุตูุงุช ุฃูููุฉ
- ๐ก๏ธ ุฅุฌุฑุงุกุงุช ููุตู ุจูุง

---

## ๐ ุงููุชุทูุจุงุช

### 1. ุงูุญุตูู ุนูู OpenAI API Key

1. ุงุฐูุจ ุฅูู: https://platform.openai.com/api-keys
2. ุณุฌูู ุฏุฎูู ุฃู ุฃูุดุฆ ุญุณุงุจ ุฌุฏูุฏ
3. ุงุถุบุท "Create new secret key"
4. ุงูุณุฎ ุงูู API key (ูุจุฏุฃ ุจู `sk-...`)

**ููุงุญุธุฉ:** ุชุญุชุงุฌ ุฅูู:
- ุญุณุงุจ OpenAI ููุนูู
- ุฅุถุงูุฉ ุฑุตูุฏ (Credit) - ุนุงุฏุฉ $5-$10 ุชููู ูุขูุงู ุงูุชุญูููุงุช
- ุงูุงุณุชุฎุฏุงู: ุญูุงูู $0.001-$0.003 ููู ุชุญููู (ูุน gpt-4o-mini)

---

## โ๏ธ ุฎุทูุงุช ุงูุฅุนุฏุงุฏ

### ุงูุฎุทูุฉ 1: ุฅุถุงูุฉ API Key

ุฃุถู ูู ููู `.env`:

```env
# OpenAI API Configuration
OPENAI_API_KEY=sk-your-api-key-here
```

### ุงูุฎุทูุฉ 2: ุชูุธูู ุงูู Cache (ููู!)

```bash
php artisan config:clear
php artisan cache:clear
```

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุชุญููู ุญุฏุซ ูุงุญุฏ

1. ุงุฐูุจ ุฅูู: `http://your-domain/waf/events`
2. ุงุถุบุท ุนูู ุฃู ุญุฏุซ ููุชุญ ุงูุชูุงุตูู
3. ุณุชุฌุฏ ุฒุฑ **"AI Analysis"** ูุน ุฃููููุฉ ๐ง
4. ุงุถุบุท ุงูุฒุฑ
5. ุณูุธูุฑ ุชุญููู ููุตู ูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู

### 2. ูุซุงู ุนูู ุงูุชุญููู

```
๐ฏ **ููุน ุงููุฌูู**: SQL Injection Attack

โ๏ธ **ูุณุชูู ุงูุฎุทูุฑุฉ**: ุนุงูู - ูุฌูู ุญูููู

๐ **ุงูุชูุงุตูู**: 
ุงูููุงุฌู ุญุงูู ุงุณุชุฎุฏุงู UNION SELECT ูุงุณุชุฎุฑุงุฌ ุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช...

๐ก **ุงูุชูุตูุงุช**:
1. ุญุธุฑ IP ุงููุตุฏุฑ ููุฑุงู
2. ูุฑุงุฌุนุฉ ุณุฌูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู Prepared Statements

๐ก๏ธ **ุงูุฅุฌุฑุงุกุงุช**:
- ูููุตุญ ุจุญุธุฑ IP: 192.168.1.100
- ุชูุนูู ูุณุชูู ุญูุงูุฉ ุฃุนูู (Paranoia Level 2)
```

---

## ๐ฐ ุงูุชูููุฉ ุงููุชููุนุฉ

### ุงุณุชุฎุฏุงู gpt-4o-mini (ุงูููุตู ุจู):
- **Input**: $0.15 / 1M tokens
- **Output**: $0.60 / 1M tokens
- **ูุชูุณุท ุงูุชุญููู ุงููุงุญุฏ**: 500-1000 tokens
- **ุงูุชูููุฉ**: ~$0.001-$0.003 ููู ุชุญููู

### ูุซุงู ุนููู:
- 1000 ุชุญููู = $1-$3
- 10,000 ุชุญููู = $10-$30

---

## ๐ง ุงููููุงุช ุงููุถุงูุฉ

```
app/
โโโ Services/
โ   โโโ AiAnalysisService.php          โ ุฎุฏูุฉ AI
โโโ Http/Controllers/
โ   โโโ WafEventController.php         โ Controller ููุชุญููู

config/
โโโ services.php                        โ (ูุญุฏูุซ) OpenAI config

routes/
โโโ web.php                             โ (ูุญุฏูุซ) Routes ููู AI

resources/views/
โโโ layouts/waf.blade.php              โ (ูุญุฏูุซ) CSRF token
โโโ waf/events.blade.php               โ (ูุญุฏูุซ) ุฒุฑ AI + Modal
```

---

## ๐จ ุงูุชุฎุตูุต

### ุชุบููุฑ Model ุงููุณุชุฎุฏู

ูู `app/Services/AiAnalysisService.php`:

```php
// ููุณุฑุนุฉ ูุงูุงูุชุตุงุฏ (ููุตู ุจู)
'model' => 'gpt-4o-mini',

// ููุฏูุฉ ุงูุนุงููุฉ (ุฃุบูู)
'model' => 'gpt-4o',

// ุฃุฑุฎุต ููู ุฃูู ุฐูุงุกู
'model' => 'gpt-3.5-turbo',
```

### ุชุฎุตูุต Prompt

ุนุฏูู ุฏุงูุฉ `buildPrompt()` ูู `AiAnalysisService.php` ูุชุบููุฑ:
- ุงููุบุฉ (ุนุฑุจู/ุฅูุฌููุฒู)
- ุงูุชูุงุตูู ุงููุทููุจุฉ
- ุทุฑููุฉ ุงูุนุฑุถ

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ: "OpenAI API key not configured"

**ุงูุญู:**
```bash
# ุชุฃูุฏ ูู ูุฌูุฏ OPENAI_API_KEY ูู .env
php artisan config:clear
```

### ุฎุทุฃ: "Failed to get AI analysis"

**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**
1. โ API key ุฎุงุทุฆ
2. โ ุฑุตูุฏ OpenAI ููุชูู
3. โ ูุดููุฉ ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช

**ุงูุชุญูู:**
```bash
# ุงุฎุชุจุฑ API key
curl https://api.openai.com/v1/models \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### ุฎุทุฃ: "Rate limit exceeded"

**ุงูุญู:** 
ุงูุชุธุฑ ุฏูููุฉ ุฃู ููู ุนุฏุฏ ุงูุทูุจุงุช. ุญุฏ OpenAI:
- Free tier: 3 requests/minute
- Paid tier: 60-3500 requests/minute (ุญุณุจ ุงูุฎุทุฉ)

---

## ๐ ุงูุฃูุงู

### ุงุญู API Key:
1. โ ูุง ุชุดุงุฑูู ุฃุจุฏุงู
2. โ ุฃุถู `.env` ูู `.gitignore`
3. โ ุงุณุชุฎุฏู environment variables ุนูู ุงูุณูุฑูุฑ
4. โ ุฑุงูุจ ุงูุงุณุชุฎุฏุงู ูู OpenAI Dashboard

### ุนูู Production:
```bash
# ุงุณุชุฎุฏู secrets management
php artisan config:cache
```

---

## ๐ ุงููุฑุงูุจุฉ

### ูุฑุงูุจุฉ ุงูุงุณุชุฎุฏุงู:
1. ููุญุฉ OpenAI: https://platform.openai.com/usage
2. ุฑุงุฌุน Tokens ุงููุณุชุฎุฏูุฉ
3. ุถุน ุญุฏ ุดูุฑู (Budget limit)

### ูู Laravel:
```php
// ูู AiAnalysisServiceุ ููููู ุญูุธ ุงูู usage
Log::info('AI Analysis used', [
    'event_id' => $event->id,
    'tokens' => $data['usage']['total_tokens'],
]);
```

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

### 1. ุฅุถุงูุฉ ุชุญููู ุงูุฃููุงุท
- ุชุญููู ูุฌููุนุฉ ุฃุญุฏุงุซ ูุนุงู
- ุงูุชุดุงู ุงููุฌูุงุช ุงูููุณูุฉ

### 2. Auto-blocking
- ุญุธุฑ ุชููุงุฆู ุจูุงุกู ุนูู ุชุญููู AI
- ููุงุนุฏ ุฏููุงููููุฉ

### 3. ุชูุงุฑูุฑ AI
- ููุฎุต ูููู/ุฃุณุจูุนู
- ุชูุตูุงุช ุชููุงุฆูุฉ

---

## ๐ ููุงุฑุฏ ุฅุถุงููุฉ

- OpenAI API Docs: https://platform.openai.com/docs
- Pricing: https://openai.com/pricing
- Rate Limits: https://platform.openai.com/docs/guides/rate-limits

---

## โ ุงูุฎูุงุตุฉ

ุงูุขู ูุฏูู:
- โ ุชุญููู AI ุฐูู ูุฃุญุฏุงุซ WAF
- โ ุชูุตูุงุช ุฃูููุฉ ููุฑูุฉ
- โ ูุงุฌูุฉ ุณููุฉ ุงูุงุณุชุฎุฏุงู
- โ ุชูููุฉ ููุฎูุถุฉ ุฌุฏุงู

**ุงุณุชูุชุน ุจุงูุญูุงูุฉ ุงูุฐููุฉ!** ๐ก๏ธ๐ค
